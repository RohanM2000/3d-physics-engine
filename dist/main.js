!function(){"use strict";!function(){function t(t){this.values=t,this.lengthI=t.length,this.lengthJ=t[0].length}function e(e){return new t([[1,0,0],[0,Math.cos(e),-Math.sin(e)],[0,Math.sin(e),Math.cos(e)]])}function i(e){return new t([[Math.cos(e),0,Math.sin(e)],[0,1,0],[-Math.sin(e),0,Math.cos(e)]])}function s(e){return new t([[Math.cos(e),-Math.sin(e),0],[Math.sin(e),Math.cos(e),0],[0,0,1]])}function o(t,e,i){this.x=parseFloat(t),this.y=parseFloat(e),this.z=parseFloat(i)}function n(){this.center=new o(-350,400,-1e3),this.velocity=new o(0,0,0),this.size=0,this.name="floor",this.rotations=new t([[1,0,0],[0,1,0],[0,0,1]]),this.vertices=[new o(this.center.x+50,this.center.y-50,this.center.z),new o(this.center.x+50,this.center.y+50,this.center.z),new o(this.center.x-50,this.center.y+50,this.center.z),new o(this.center.x-50,this.center.y-50,this.center.z)],this.faces=[[this.vertices[0],this.vertices[1],this.vertices[2],this.vertices[3],"black"]]}function r(){}function c(){}t.prototype.multiply=function(e){const i=[];for(let t=0;t<this.lengthI;t++){const s=[];for(let i=0;i<e.lengthJ;i++){let o=0;for(let s=0;s<this.lengthJ;s++)o+=this.values[t][s]*e.values[s][i];s.push(o)}i.push(s)}return new t(i)},t.prototype.simplifyZeros=function(){for(let t=0;t<this.lengthI;t++)for(let e=0;e<this.lengthJ;e++)Math.abs(this.values[t][e])<.001&&(this.values[t][e]=0)},t.prototype.dupe=function(){const e=[];for(let t=0;t<this.lengthI;t++)e.push(this.values[t].slice());return new t(e)},o.prototype.move=function(t,e,i){this.x+=t,this.y+=e,this.z+=i},o.prototype.rotateX=function(i){const s=e(i),o=new t([[this.x],[this.y],[this.z]]),n=s.multiply(o);this.x=n.values[0][0],this.y=n.values[1][0],this.z=n.values[2][0]},o.prototype.rotateY=function(e){const s=i(e),o=new t([[this.x],[this.y],[this.z]]),n=s.multiply(o);this.x=n.values[0][0],this.y=n.values[1][0],this.z=n.values[2][0]},o.prototype.rotateZ=function(e){const i=s(e),o=new t([[this.x],[this.y],[this.z]]),n=i.multiply(o);this.x=n.values[0][0],this.y=n.values[1][0],this.z=n.values[2][0]},o.prototype.multiplyBy=function(e){const i=e.multiply(new t([[this.x],[this.y],[this.z]]));return new o(i.values[0][0],i.values[1][0],i.values[2][0])},o.prototype.dupe=function(){return new o(this.x,this.y,this.z)},r.prototype=c.prototype,n.prototype=new r,n.prototype.dupe=function(){const t=new n;t.center=this.center.dupe(),t.rotations=this.rotations.dupe();for(let e=0;e<t.vertices.length;e++)t.vertices[e]=this.vertices[e].dupe();return this.fixFaces(),t},n.prototype.fixFaces=function(){this.faces=[[this.vertices[0],this.vertices[1],this.vertices[2],this.vertices[3],"black"]]},n.prototype.fall=function(){},n.prototype.jump=function(){},c.prototype.move=function(t,e,i){this.center.move(t,e,i);for(let s=0;s<this.vertices.length;s++)this.vertices[s].move(t,e,i)},c.prototype.absRotateX=function(t){this.rotateX(t),this.center.rotateX(t);for(let e=0;e<this.vertices.length;e++)this.vertices[e].rotateX(t)},c.prototype.absRotateY=function(t){this.rotateY(t),this.center.rotateY(t);for(let e=0;e<this.vertices.length;e++)this.vertices[e].rotateY(t)},c.prototype.absRotateZ=function(t){this.rotateZ(t),this.center.rotateZ(t);for(let e=0;e<this.vertices.length;e++)this.vertices[e].rotateZ(t)},c.prototype.checkCollision=function(t){if(t instanceof n&&this.center.z-this.size/2<t.center.z)return!0;if(Math.abs(this.center.z-t.center.z)<this.size/2+t.size/2){if(t instanceof n)return!0;if(this.center.x===t.center.x&&this.center.y===t.center.y)return!0}return!1},c.prototype.resolveCollisionZ=function(t){if(this instanceof n&&t instanceof n)return!1;if(t instanceof n){const e=t.center.z-(this.center.z-this.size/2);this.move(0,0,e),this.velocity.z=0}else if(this.center.z-this.size/2>t.center.z-t.size/2){const e=t.center.z+t.size/2-(this.center.z-this.size/2);this.move(0,0,e),this.velocity.z=0}else{const e=this.center.z+this.size/2-(t.center.z-t.size/2);t.move(0,0,e),t.velocity.z=0}},c.prototype.rotateX=function(t){const i=e(t);this.rotations=i.multiply(this.rotations)},c.prototype.rotateY=function(t){const e=i(t);this.rotations=e.multiply(this.rotations)},c.prototype.rotateZ=function(t){const e=s(t);this.rotations=e.multiply(this.rotations)},c.prototype.rotate=function(){const t=this.dupe();t.center=t.center.multiplyBy(t.rotations);for(let e=0;e<t.vertices.length;e++)t.vertices[e]=t.vertices[e].multiplyBy(t.rotations);return t.fixFaces(),t},c.prototype.jump=function(t){let e,i;e=this.staticCenter.x>0?3:2,i=this.staticCenter.y>750?1.2:.8,this.velocity.z+=15+3*(this.center.z-t)/100*e*i};const h=.7;function a(e,i){this.velocity=new o(0,0,0),this.acceleration=new o(0,0,-h),this.size=i,this.name="cube";const s=i/2;this.center=e,this.staticCenter=new o(this.center.x,this.center.y,this.center.z),this.rotations=new t([[1,0,0],[0,1,0],[0,0,1]]),this.vertices=[new o(e.x-s,e.y-s,e.z-s),new o(e.x+s,e.y-s,e.z-s),new o(e.x+s,e.y-s,e.z+s),new o(e.x-s,e.y-s,e.z+s),new o(e.x+s,e.y+s,e.z-s),new o(e.x-s,e.y+s,e.z-s),new o(e.x-s,e.y+s,e.z+s),new o(e.x+s,e.y+s,e.z+s)],this.faces=[[this.vertices[0],this.vertices[1],this.vertices[2],this.vertices[3],"red"],[this.vertices[4],this.vertices[5],this.vertices[6],this.vertices[7],"blue"],[this.vertices[1],this.vertices[4],this.vertices[7],this.vertices[2],"green"],[this.vertices[5],this.vertices[0],this.vertices[3],this.vertices[6],"orange"],[this.vertices[5],this.vertices[4],this.vertices[1],this.vertices[0],"gray"],[this.vertices[3],this.vertices[2],this.vertices[7],this.vertices[6],"purple"]]}function l(){}function v(t,e){this.x=parseFloat(t),this.z=parseFloat(e)}function u(t,e){return new v(e*t.x/(t.y+e),e*t.z/(t.y+e))}function p(t){if(t.length<=1)return t;const e=[],i=[],s=t[0],o=[s];for(let o=1;o<t.length;o++){const n=t[o];n.center.y<s.center.y?i.push(n):e.push(n)}const n=p(e),r=p(i);return n.concat(o).concat(r)}function y(t,e,i,s,o){const n=[];for(let e=0;e<t.length;e++)n.push(t[e].rotate());const r=p(n);for(let t=0;t<r.length;t++)if(r[t].center.y>100){const n=r[t].faces;for(let t=0;t<n.length;t++){const r=n[t],c=[0,0],h=u(r[0],o);c[0]+=h.x,c[1]+=h.z,e.beginPath(),e.moveTo(h.x+i,s-h.z);for(let t=1;t<r.length-1;t++){const n=u(r[t],o);c[0]+=n.x,c[1]+=n.z,e.lineTo(n.x+i,s-n.z)}e.fillStyle=r[r.length-1],e.closePath(),c[0]=c[0]/(r.length-1),c[1]=c[1]/(r.length-1);const a=u(r[0],o),l=u(r[1],o),v=[a.x-c[0],a.z-c[1]],p=[l.x-c[0],l.z-c[1]];v[0]*p[1]>v[1]*p[0]&&(e.stroke(),e.fill())}}}function f(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.position=t,this.zTheta=e,this.zPhi=i,this.zOmega=s}function d(t,e,i){this.camera=t,this.background=i,this.x=new o(1,0,0),this.y=new o(0,1,0),this.z=new o(0,0,1),this.objects=[],this.floors=[];for(let t=0;t<e.length;t++)e[t]instanceof n?this.floors.push(e[t]):this.objects.push(e[t])}function m(){this.center=new o(0,0,0),this.vertices=[new o(-5e3,-5e3,-5e3),new o(5e3,-5e3,-5e3),new o(5e3,-5e3,5e3),new o(-5e3,-5e3,5e3),new o(5e3,5e3,-5e3),new o(-5e3,5e3,-5e3),new o(-5e3,5e3,5e3),new o(5e3,5e3,5e3)],this.rotations=new t([[1,0,0],[0,1,0],[0,0,1]]),this.faces=[[this.vertices[0],this.vertices[1],this.vertices[2],this.vertices[3],"gray"],[this.vertices[4],this.vertices[5],this.vertices[6],this.vertices[7],"gray"],[this.vertices[1],this.vertices[4],this.vertices[7],this.vertices[2],"lightblue"],[this.vertices[5],this.vertices[0],this.vertices[3],this.vertices[6],"lightblue"],[this.vertices[5],this.vertices[4],this.vertices[1],this.vertices[0],"black"],[this.vertices[3],this.vertices[2],this.vertices[7],this.vertices[6],"black"]]}function z(){}function w(e,i){this.velocity=new o(0,0,0),this.acceleration=new o(0,0,-h),this.size=i,this.name="pyramid";const s=i/2;this.center=e,this.staticCenter=new o(this.center.x,this.center.y,this.center.z),this.rotations=new t([[1,0,0],[0,1,0],[0,0,1]]),this.vertices=[new o(e.x-s,e.y-s,e.z-s),new o(e.x+s,e.y-s,e.z-s),new o(e.x+s,e.y+s,e.z-s),new o(e.x-s,e.y+s,e.z-s),new o(e.x,e.y,e.z+s)],this.faces=[[this.vertices[0],this.vertices[3],this.vertices[2],this.vertices[1],"red"],[this.vertices[0],this.vertices[1],this.vertices[4],"blue"],[this.vertices[1],this.vertices[2],this.vertices[4],"green"],[this.vertices[2],this.vertices[3],this.vertices[4],"orange"],[this.vertices[0],this.vertices[4],this.vertices[3],"gray"]]}function g(){}function x(t){const e=new a(new o(0,0,0),t.size);return e.move(t.center.x,t.center.y,t.center.z),e.staticCenter.move(t.center.x,t.center.y,t.center.z),e.rotations.values=t.rotations.values,e.velocity.move(t.velocity.x,t.velocity.y,t.velocity.z),e.fixFaces(),e}function b(t){const e=new w(new o(0,0,0),t.size);return e.move(t.center.x,t.center.y,t.center.z),e.staticCenter.move(t.center.x,t.center.y,t.center.z),e.rotations.values=t.rotations.values,e.velocity.move(t.velocity.x,t.velocity.y,t.velocity.z),e.fixFaces(),e}function j(t){const e=new n;return e.move(t.center.x+350,t.center.y-400,t.center.z+1e3),e.rotations.values=t.rotations.values,e.velocity.move(t.velocity.x,t.velocity.y,t.velocity.z),e.fixFaces(),e}l.prototype=c.prototype,a.prototype=new l,a.prototype.fall=function(){this.velocity.move(this.acceleration.x,this.acceleration.y,this.acceleration.z),this.move(this.velocity.x,this.velocity.y,this.velocity.z)},a.prototype.dupe=function(){const t=new a(this.center,this.size);t.rotations=this.rotations.dupe();for(let e=0;e<0;e++)t.vertices[e]=this.vertices[e].dupe();return t},a.prototype.fixFaces=function(){this.faces=[[this.vertices[0],this.vertices[1],this.vertices[2],this.vertices[3],"red"],[this.vertices[4],this.vertices[5],this.vertices[6],this.vertices[7],"blue"],[this.vertices[1],this.vertices[4],this.vertices[7],this.vertices[2],"green"],[this.vertices[5],this.vertices[0],this.vertices[3],this.vertices[6],"orange"],[this.vertices[5],this.vertices[4],this.vertices[1],this.vertices[0],"gray"],[this.vertices[3],this.vertices[2],this.vertices[7],this.vertices[6],"purple"]]},f.prototype.move=function(t,e,i){this.position.x+=t,this.position.y+=e,this.position.z+=i},f.prototype.turn=function(t){this.zTheta+=t},f.prototype.dip=function(t){this.zPhi-=t},f.prototype.screw=function(t){this.zOmega+=t},d.prototype.turn=function(t){this.camera.turn(t);for(let e=0;e<this.objects.length;e++)this.objects[e].rotateZ(-t);for(let e=0;e<this.floors.length;e++)this.floors[e].rotateZ(-t);this.x.rotateZ(-t),this.y.rotateZ(-t),this.z.rotateZ(-t)},d.prototype.dip=function(t){this.camera.dip(t);for(let e=0;e<this.objects.length;e++)this.objects[e].rotateX(t);for(let e=0;e<this.floors.length;e++)this.floors[e].rotateX(t);this.x.rotateX(t),this.y.rotateX(t),this.z.rotateX(t)},d.prototype.screw=function(t){this.camera.dip(t);for(let e=0;e<this.objects.length;e++)this.objects[e].rotateY(-t);for(let e=0;e<this.floors.length;e++)this.floors[e].rotateY(-t);this.x.rotateY(-t),this.y.rotateY(-t),this.z.rotateY(-t)},d.prototype.move=function(t,e,i){this.camera.move(t,e,i);for(let s=0;s<this.objects.length;s++)this.objects[s].move(-t,-e,-i);for(let s=0;s<this.floors.length;s++)this.floors[s].move(-t,-e,-i)},d.prototype.fall=function(){const t=this.objects.concat(this.floors);for(let t=0;t<this.objects.length;t++)this.objects[t].fall();for(let e=0;e<t.length-1;e++)for(let i=e+1;i<t.length;i++)t[e].checkCollision(t[i])&&t[e].resolveCollisionZ(t[i])},d.prototype.jump=function(t){for(let e=0;e<this.objects.length;e++)this.objects[e].jump(t)},d.prototype.addObject=function(t){t instanceof n?this.floors.push(t):this.objects.push(t)},d.prototype.render=function(t,e,i,s){y(this.floors,t,e,i,s),y(this.objects,t,e,i,s)},z.prototype=c.prototype,m.prototype=new z,g.prototype=c.prototype,w.prototype=new g,w.prototype.fall=function(){this.velocity.move(this.acceleration.x,this.acceleration.y,this.acceleration.z),this.move(this.velocity.x,this.velocity.y,this.velocity.z)},w.prototype.dupe=function(){const t=new w(this.center,this.size);t.rotations=this.rotations.dupe();for(let e=0;e<0;e++)t.vertices[e]=this.vertices[e].dupe();return t},w.prototype.fixFaces=function(){this.faces=[[this.vertices[0],this.vertices[3],this.vertices[2],this.vertices[1],"red"],[this.vertices[0],this.vertices[1],this.vertices[4],"blue"],[this.vertices[1],this.vertices[2],this.vertices[4],"green"],[this.vertices[2],this.vertices[3],this.vertices[4],"orange"],[this.vertices[0],this.vertices[4],this.vertices[3],"gray"]]},document.addEventListener("DOMContentLoaded",(t=>{const e=document.getElementById("3d-canvas").getContext("2d"),i=new m;let s=new f(new o(0,0,0),0),r=new d(s,[],i);function c(t){F&&requestAnimationFrame((()=>c(t))),e.clearRect(0,0,600,600),e.fillStyle="lightblue",e.fillRect(0,0,600,600),t.fall(),t.render(e,300,300,200)}document.addEventListener("keydown",(t=>{"a"===t.key&&r.turn(.2),"d"===t.key&&r.turn(-.2),"w"===t.key&&r.dip(-.2),"s"===t.key&&r.dip(.2),"q"===t.key&&r.screw(-.2),"e"===t.key&&r.screw(.2),"ArrowUp"===t.key&&r.move(0,0,10),"ArrowDown"===t.key&&r.move(0,0,-10),"ArrowLeft"===t.key&&r.move(-10,0,0),"ArrowRight"===t.key&&r.move(10,0,0),"r"===t.key&&r.move(0,10,0),"f"===t.key&&r.move(0,-10,0),"o"===t.key&&r.jump()})),document.getElementById("shake").addEventListener("click",(t=>{r.jump(r.floors[0].center.z)}));const h=document.querySelector("div.answers"),l=document.getElementById("proj"),v=function(t,e){let i=!0;return function(){i&&(function(t){const e=h.children;for(let t=0;t<e.length;t++)e[t].remove();h.appendChild(t)}(...arguments),i=!1,setTimeout((()=>{i=!0}),2e3))}}();l.addEventListener("click",(t=>{const e=document.createElement("p");e.innerText="Projections are mappings of 3d objects to a 2d plane. Think of the shadow of a cube. As you rotate that cube, the shadow will change as well. That is the principle that drives 3d engines.",v(e)})),document.getElementById("rot").addEventListener("click",(t=>{const e=document.createElement("p");e.innerText="Rotations work by leveraging trigonometry to change the positions of vertices on each object, and then rendering from the new positions.",v(e)})),document.getElementById("what").addEventListener("click",(t=>{const e=document.createElement("p");e.innerText="This engine is made with 2d canvas and a simple physics engine made from scratch that considers every object a non-rotational hard body. To read more about the underlying math concepts click me.",v(e)}));const u=document.querySelector("div.add-items");u.dataset.Shape="none";for(let t=0;t<64;t++){const e=document.createElement("button");e.dataset.Id=t,e.dataset.Finish="false",u.appendChild(e);const i=new n,s=Math.floor(t/8),o=t%8;i.move(100*o,100*s,0),r.addObject(i)}r.move(0,0,-500),r.move(0,-100,0),r.dip(.2);const p=function(t,e){let i=0;return function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];i+=1,setTimeout((()=>{i-=1,0===i&&function(t){r.addObject(t)}(...e)}),300)}}();u.addEventListener("click",(t=>{const e=t.target.dataset.Id,i=Math.floor(e/8),n=e%8;let c;"true"===t.target.dataset.Finish?alert("Cannot place objects on top of pyramid, will cause unstable structure."):"cube"===t.currentTarget.dataset.Shape?(c=new a(new o(100*n-350,1100-100*i,1e3),100),c.move(-s.position.x,-s.position.y,-s.position.z),c.rotations=r.floors[0].rotations,p(c)):"pyramid"===t.currentTarget.dataset.Shape?(c=new w(new o(100*n-350,1100-100*i,1e3),100),c.move(-s.position.x,-s.position.y,-s.position.z),c.rotations=r.floors[0].rotations,p(c),t.target.dataset.Finish="true"):alert("Please select a shape.")}));const y=document.getElementById("cube"),z=document.getElementById("pyramid");y.addEventListener("click",(t=>{u.dataset.Shape="cube",y.classList.add("selected"),z.classList.remove("selected")})),z.addEventListener("click",(t=>{u.dataset.Shape="pyramid",z.classList.add("selected"),y.classList.remove("selected")}));const g=document.getElementById("new"),k=document.getElementById("save"),E=document.getElementById("load");g.addEventListener("click",(t=>{F=!1,s=new f(new o(0,0,0),0),r=new d(s,[],i);for(let t=0;t<64;t++){const e=new n,i=Math.floor(t/8),s=t%8;e.move(100*s,100*i,0),r.addObject(e)}r.move(0,0,-500),r.move(0,-100,0),r.dip(.2);const e=u.children;for(let t=0;t<e.length;t++)e[t].dataset.Finish="false";F=!0,c(r)})),k.addEventListener("click",(t=>{const e=[],i=u.children;for(let t=0;t<i.length;t++)e.push(i[t].dataset.Finish);localStorage.setItem("scene",JSON.stringify(r)),localStorage.setItem("finishArray",JSON.stringify(e))})),E.addEventListener("click",(t=>{F=!1;const e=JSON.parse(localStorage.getItem("scene")),i=JSON.parse(localStorage.getItem("finishArray"));r=function(t){const e=function(t){const e=new f(new o(0,0,0));return e.position.x=t.position.x,e.position.y=t.position.y,e.position.z=t.position.z,e.zTheta=t.zTheta,e.zPhi=t.zPhi,e.zOmega=t.zOmega,e}(t.camera),i=new d(e,[],new m);for(let e=0;e<t.floors.length;e++){const s=j(t.floors[e]);i.addObject(s)}for(let e=0;e<t.objects.length;e++){if("cube"===t.objects[e].name){const s=x(t.objects[e]);i.addObject(s)}if("pyramid"===t.objects[e].name){const s=b(t.objects[e]);i.addObject(s)}}return i.x=new o(t.x.x,t.x.y,t.x.z),i.y=new o(t.y.x,t.y.y,t.y.z),i.z=new o(t.z.x,t.z.y,t.z.z),i}(e);const s=u.children;for(let t=0;t<s.length;t++)s[t].dataset.Finish=i[t];F=!0,c(r)}));let F=!0;c(r)}))}()}();
//# sourceMappingURL=main.js.map